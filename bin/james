#!/bin/bash

  repo_path="/Users/admin/GitHub"

  while [[ $# -gt 0 ]]; do
    key="${1}"
    case "${key}" in
    -m|--manifest)
    manifest="${2}"
    shift
    shift
    ;;
    -o|--object)
    object="${2}"
    shift
    shift
    ;;
    -e|--endpoint)
    endpoint="${2}"
    shift
    ;;
    *)
    positional+=("${1}")
    shift
    ;;
    esac
  done

  set -- "${positional[@]}"

  if [ -z "${manifest}" ]; then
    echo "Error: argument manifest can not be empty" && exit 1
  elif [ -z "${object}" ]; then
    echo "Error: argument object can not be empty" && exit 1
  elif [ -z "${endpoint}" ]; then
    echo "Error: argument endpoint can not be empty" && exit 1
  fi

  if [ -s "${repo_path}/james/manifests/${manifest}.json" ]; then

    echo "Manifest: '${manifest}'"
    echo "Endpoint: '${endpoint}'"
    echo "Object: '${object}'"

    jq \
      --arg e "${endpoint}" \
      --arg o "${object}" \
      '.[$e] |= (. + [$o] | unique)' \
      "${repo_path}/james/manifests/${manifest}.json" | sponge "${repo_path}/james/manifests/${manifest}.json"

  else
    echo "Error: Manifest '${manifest}' not found!" && exit 1
  fi